## Docker Compose

Docker Compose is a tool used for defining and running multi-container Docker applications. It allows you to define a set of services (containers) that make up your application in a YAML file, and then use that configuration to spin up all those containers with a single command.

Here are some key uses of Docker Compose:

Multi-Container Applications: Docker Compose is ideal for applications that require multiple containers to work together, such as a web server, a database, and potentially other services like caching servers or message brokers.

**Service Definition:** It allows you to define the services, networks, and volumes required for your application in a declarative YAML file (`docker-compose.yml`). This file specifies how the containers should be configured and linked together.

**Single Command Control:** With Docker Compose, you can start, stop, and restart all containers in your application with a single command (`docker-compose up`, `docker-compose down`, etc.), making it easier to manage complex applications.

**Environment Configuration:** Docker Compose supports environment variables and command-line overrides, allowing you to easily customize your application’s configuration without modifying the `docker-compose.yml` file.

**Networking:** It automatically creates a network for your application’s containers, allowing them to communicate with each other securely without needing to expose ports to the host machine.

**Volume Management:** Docker Compose manages the volume creation and sharing between containers, which is essential for persisting data generated by and used by your application.

Overall, Docker Compose simplifies the process of running Docker containers in development, testing, and production environments, providing a consistent environment across different deployment scenarios.

## Installing Docker Compose

You already have installed Docker Desktop it includes Docker Engine, Docker CLI, and Docker Compose all in one package. Docker Desktop is available for Windows, macOS, and Linux.

Use the following command to check which version is installed:

    docker compose version

## Docker Compose File

A Docker Compose file, written in YAML format, is the heart of defining and managing multi-container applications with Docker. It specifies the configuration for each container service that makes up your application. Here's a breakdown with an example using Python and PostgreSQL:

**Structure of a Docker Compose File:**

A typical Compose file consists of service definitions. Each service represents a single container, and you define its properties like:

* **image:** The Docker image to use for the container (e.g., `python:3.11`).
* **ports:** Maps ports on the container to ports on the host machine (e.g., `8000:8000`).


**Example: Python**

This example demonstrates a Compose file with a single Python FastAPI service:

```yaml
version: "3.9"

name: myapi

services:
  api:
    build:
      context: ./todo
      dockerfile: Dockerfile.dev
    ports:
      - "8000:8000"  # Expose container port 8000 to host port 8000  

```

**Explanation:**

* **version:** This specifies the Docker Compose file version (here, version 3.9).
* **services:** This section defines only one service:
    * `api`: This builds a container image from the todo directory with Dockerfile.dev file. It exposes port 8000.
    

**Running the application:**


With this Compose file saved as `compose.yml`, you can use the following commands to manage your application:

Do not forget to add .env file with database credentials before building and running the api.

* `docker compose up -d`: This builds the images (if needed) and starts the container in detached mode (background). You can check it by going open: http://0.0.0.0:8000/ in browser.
* `docker compose stop`: This stops the container.
* `docker compose down`: This stops and removes the container.

Note:

The flag `-d` in the command `docker-compose up -d` instructs Docker Compose to run the containers in **detached mode**. Here's what that means:

* **Normal vs. Detached Mode:**
  * By default, the `docker-compose up` command starts the defined services in the foreground. This means the terminal window you run the command from stays open and displays logs from the running containers.
  * With the `-d` flag, Docker Compose starts the containers in the background. This allows the terminal window to be closed, and the containers continue to run independently.

* **Benefits of Detached Mode:**
  * Frees up your terminal window for other tasks.
  * Useful for long-running services that don't require constant interaction.

* **Viewing Logs for Detached Containers:**
   * To view logs from detached containers, use `docker-compose logs` followed by the service name(s).

In summary, the `-d` flag allows you to run Docker Compose services in the background, keeping your terminal free and the containers operational even after the window is closed.

## YAML Crash Course for Docker Compose

Docker Compose uses YAML (YAML Ain't Markup Language) to define your multi-container application. YAML is a human-readable data serialization language, similar to JSON, but with a focus on readability. Here's a breakdown to get you started with YAML in Docker Compose:

**Basic Structure:**

A YAML file is a collection of key-value pairs. Indentation is crucial for defining the structure. More indented elements are nested under the parent element. Here's an example:

```yaml
name: John Doe
age: 30
address:
  street: 123 Main St
  city: Anytown
```

In this example, "name," "age," and "address" are keys. "John Doe," "30," and the nested structure define the values.

**Data Types:**

YAML supports various data types, including:

* **Scalars:** Strings (e.g., "hello"), numbers (e.g., 42), booleans (e.g., true, false)
* **Lists:** Ordered collections of items, enclosed in square brackets `[]` (e.g., ["apple", "banana"])
* **Mappings:** Unordered collections of key-value pairs, enclosed in curly braces `{}` (e.g., {name: "Alice", age: 25})


**Tips and Best Practices:**

* Use proper indentation for readability.
* Use comments (`#`) to explain sections of your YAML file.
* Leverage online YAML validators to check your syntax.
* Refer to the official Docker Compose documentation for a complete list of available options: 

https://docs.docker.com/compose/compose-file/compose-file-v3/

By understanding YAML basics, you'll be well-equipped to write clear and effective Docker Compose files to manage your multi-container applications.